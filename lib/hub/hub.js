// Generated by CoffeeScript 1.6.3
var engine;

engine = require('engine.io');

module.exports = function(config) {
  var local;
  return local = {
    server: void 0,
    clients: {},
    timestamp: function() {
      return new Date;
    },
    listen: function() {
      var server;
      local.server = server = engine.listen(config.listen.port);
      return server.on('connection', function(socket) {
        local.clients[socket.id] = {
          status: {
            value: 'connecting',
            at: local.timestamp()
          },
          socket: socket
        };
        return socket.on('message', function(data) {
          var version;
          version = data[0];
          return console.log({
            protocol_version: version,
            payload: JSON.parse(data.slice(1))
          });
        });
      });
    },
    close: function() {}
  };
};
