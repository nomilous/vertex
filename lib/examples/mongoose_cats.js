// Generated by CoffeeScript 1.6.3
var Kitten, kittySchema, mongoose, routes;

mongoose = require('mongoose').connect('mongodb://localhost/test');

kittySchema = mongoose.Schema({
  name: {
    type: String,
    index: {
      unique: true
    }
  }
});

Kitten = mongoose.model('Kitten', kittySchema);

require('../vertex')({
  http: {
    listen: {
      port: 3000
    }
  },
  root: routes = {
    kittens: function(_arg, callback) {
      var body, id, method, rest;
      method = _arg.method, body = _arg.body, rest = _arg.rest;
      switch (method) {
        case 'POST':
          return Kitten.create(body, function(err, kitten) {
            if (err != null) {
              return callback(null, {
                statusCode: 409,
                error: err
              });
            }
            return callback(null, kitten);
          });
        case 'GET':
          if (id = rest.pop()) {
            return Kitten.findById(id, function(err, kitten) {
              if (err != null) {
                return callback(null, {
                  statusCode: 400,
                  error: err
                });
              }
              if (kitten == null) {
                callback(null, {
                  statusCode: 404
                });
              }
              return callback(null, kitten);
            });
          }
      }
    }
  }
});

routes.kittens.$api = {};
