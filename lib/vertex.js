// Generated by CoffeeScript 1.6.3
var Http, Hub, Q, deferred, _ref;

Http = require('./www/http');

Hub = require('./hub/hub');

_ref = require('decor'), Q = _ref.Q, deferred = _ref.deferred;

module.exports.create = deferred(function(action, config) {
  var title, uuid;
  title = config.title || 'Untitled Vertex';
  uuid = config.uuid || 'pending default uuid';
  return Q.all([
    (function() {
      if (!(function() {
        try {
          return config.www.listen != null;
        } catch (_error) {}
      })()) {
        return;
      }
      return Http.create(config).listen();
    })(), (function() {
      if (config.listen == null) {
        return;
      }
      return Hub.create(config).listen();
    })()
  ]).spread(function(www, hub) {
    if (www != null) {
      console.log('www listening', www.server.address());
    }
    if (hub != null) {
      console.log('hub listening', hub.transport.address());
    }
    return action.resolve({
      www: www,
      hub: hub
    });
  }, function(error) {
    return action.reject(error);
  });
});

module.exports.create.www = function(config) {
  var _base;
  if (config == null) {
    config = {};
  }
  config.listen || (config.listen = {});
  (_base = config.listen).port || (_base.port = 3000);
  return module.exports.create({
    www: config
  });
};
